<h1>Role Management</h1>

<% if flash[:notice] %>
  <div class="alert alert-success"><%= flash[:notice] %></div>
<% end %>

<% if flash[:alert] %>
  <div class="alert alert-danger"><%= flash[:alert] %></div>
<% end %>

<% if flash[:status_message] %>
  <p><%= flash[:status_message] %></p>
<% end %>

<% if flash[:error_message] %>
  <p><%= flash[:error_message] %></p>
<% end %>

<%# Success banner for AC1/AC2 %>
<% if flash[:success].present? %>
  <div class="alert-success">
    <%= flash[:success] %>
  </div>
<% end %>

<%# Error banner for AC4 %>
<% if flash[:error].present? %>
  <div class="alert-danger">
    <%= flash[:error] %>
  </div>
<% end %>

<%# Also show any generic notices/alerts (like "ash@poke.com is now a moderator") %>
<% if flash[:notice].present? %>
  <p><%= flash[:notice] %></p>
<% end %>

<% if flash[:alert].present? %>
  <p><%= flash[:alert] %></p>
<% end %>

<table>
  <thead>
  <tr>
    <th>Email</th>
    <th>Role</th>
    <th>Actions</th>
  </tr>
  </thead>

  <tbody>
  <% @users.each do |user| %>
    <tr>
      <td><%= user.email %></td>
      <td><%= user.role.humanize %></td>
      <td><%= user.role.titleize %></td>
      <td>
        <% if current_user.admin? %>
          <% if user.admin? %>
            <!-- Admin cannot change their own admin status via UI -->
            <em>Admin</em>
          <% elsif user.moderator? %>
            <%= button_to "Demote",
                          user_path(user),
                          method: :patch,
                          params: { user: { role: "user" } } %>
          <% else %>
            <%= button_to "Promote",
                          user_path(user),
                          method: :patch,
                          params: { user: { role: "moderator" } } %>
          <% end %>
        <% else %>
          <!-- Non-admins see the roles but no role-change controls -->
          <em>No controls</em>
        <% end %>
      </td>

    </tr>
  <% end %>
  </tbody>
</table>
