<%= form_with model: @team, local: true do |f| %>
  <% if flash[:alert] %>
    <div class="flash alert"><%= flash[:alert] %></div>
  <% end %>

  <% if @team.any_illegal_slots? %>
    <div id="error-summary" class="flash alert" data-role="error-summary" style="margin-bottom: 1.5rem;">
      <h4 style="margin-bottom: 0.5rem;">‚ö†Ô∏è Unresolved Issues</h4>
      <ul style="margin: 0; padding-left: 1.5rem;">
        <% @team.team_slots.each do |slot| %>
          <% if slot.illegal? %>
            <li>Slot <%= slot.slot_index %>: <%= slot.illegality_reason %></li>
          <% end %>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- Team Header Card -->
  <div class="card" style="margin-bottom: 1.5rem;">
    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1rem; align-items: end;">
      <div class="form-group" style="margin-bottom: 0;">
        <%= f.label :name, "Team Name" %>
        <%= f.text_field :name, placeholder: "My Awesome Team" %>
      </div>

      <div class="form-group" style="margin-bottom: 0;">
        <%= f.label :visibility, "Visibility" %>
        <%= f.select :visibility,
                     [["üîí Private", "private_team"], ["üåê Public", "public_team"]] %>
      </div>
    </div>

    <div style="display: flex; gap: 1rem; align-items: center; margin-top: 1rem; flex-wrap: wrap;">
      <span class="badge badge-<%= @team.status %>"><%= @team.status.to_s.capitalize %></span>
      <span class="badge badge-<%= @team.public_team? ? 'public' : 'private' %>"><%= @team.visibility_label %></span>
      <span class="text-muted text-small" data-last-saved="true">
        Last saved: <%= @team.last_saved_at.present? ? @team.last_saved_at.strftime("%b %d, %Y at %I:%M %p") : "Not yet saved" %>
      </span>
    </div>
  </div>

  <!-- Action Buttons (Top) -->
  <div class="flex gap-2" style="margin-bottom: 1.5rem; flex-wrap: wrap;">
    <%= f.submit "üíæ Save", class: "btn btn-primary" %>
    <%= f.submit "‚úì Validate", class: "btn btn-secondary" %>
    <%= f.submit "‚ûï Add Pok√©mon", class: "btn btn-secondary" %>
    
    <% publish_disabled = @team.any_illegal_slots? %>
    <%= f.submit "üöÄ Publish",
                 data: { action: "publish" },
                 disabled: publish_disabled,
                 class: "btn btn-primary",
                 style: publish_disabled ? "opacity: 0.5; cursor: not-allowed;" : "",
                 "aria-disabled": (publish_disabled ? "true" : "false") %>
  </div>

  <!-- Team Slots -->
  <h2 style="margin-bottom: 1rem;">‚öîÔ∏è Team Roster</h2>
  <div class="team-slots">
    <% @team.team_slots.each do |slot| %>
      <%= render "slot_fields", f: f, slot: slot %>
    <% end %>
  </div>

  <!-- Action Buttons (Bottom) -->
  <div class="flex gap-2" style="margin-top: 1.5rem; flex-wrap: wrap;">
    <%= f.submit "üíæ Save", class: "btn btn-primary" %>
    <%= f.submit "‚úì Validate", class: "btn btn-secondary" %>
    
    <% publish_disabled = @team.any_illegal_slots? %>
    <%= f.submit "üöÄ Publish",
                 data: { action: "publish" },
                 disabled: publish_disabled,
                 class: "btn btn-primary",
                 style: publish_disabled ? "opacity: 0.5; cursor: not-allowed;" : "",
                 "aria-disabled": (publish_disabled ? "true" : "false") %>
    
    <%= link_to "‚Üê Back to Home", root_path, class: "btn btn-secondary" %>
  </div>
<% end %>
