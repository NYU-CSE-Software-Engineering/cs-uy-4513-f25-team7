<% if user_signed_in? %>
  <div class="welcome-section">
    <h1>Welcome back, <%= current_user.display_name %>!</h1>
    <p class="text-muted">Hello, <%= current_user.email %></p>
    <p class="text-muted">Ready to catch 'em all? Here's your dashboard.</p>
  </div>

  <div class="quick-links">
    <%= link_to new_team_path, class: "quick-link" do %>
      <div class="quick-link-icon">ğŸ®</div>
      <div>New Team</div>
    <% end %>
    
    <%= link_to species_index_path, class: "quick-link" do %>
      <div class="quick-link-icon">ğŸ”</div>
      <div>Species Lookup</div>
    <% end %>

    <%= link_to posts_path, class: "quick-link" do %>
      <div class="quick-link-icon">ğŸ’¬</div>
      <div>Forum</div>
    <% end %>
    
    <%= link_to feed_path, class: "quick-link" do %>
      <div class="quick-link-icon">ğŸ“°</div>
      <div>My Feed</div>
    <% end %>
  </div>

  <hr>

  <h2>âš”ï¸ My Teams</h2>

  <% if @teams.any? %>
    <div class="team-list">
      <% @teams.each do |team| %>
        <div class="team-item">
          <div>
            <h4 style="margin-bottom: 0.25rem;"><%= link_to team.name, edit_team_path(team) %></h4>
            <div class="flex gap-1" style="align-items: center;">
              <span class="badge badge-<%= team.status %>"><%= team.status %></span>
              <span class="badge badge-<%= team.public_team? ? 'public' : 'private' %>"><%= team.visibility_label %></span>
              <% if team.last_saved_at %>
                <span class="text-muted text-small">Â· <%= time_ago_in_words(team.last_saved_at) %> ago</span>
              <% end %>
            </div>
          </div>

          <div class="team-actions" style="display: flex; gap: 0.5rem; align-items: center;">
            <%= link_to "Edit â†’",
                        edit_team_path(team),
                        class: "btn btn-secondary btn-small" %>

            <%= link_to "Delete",
                        team_path(team),
                        data: {
                          turbo_method: :delete,
                          turbo_confirm: "Are you sure you want to delete this team?"
                        },
                        class: "btn btn-danger btn-small" %>
          </div>
        </div>
    <% end %>
    </div>

  <% else %>
    <div class="card text-center" style="padding: 3rem;">
      <p style="font-size: 3rem; margin-bottom: 1rem;">ğŸ¯</p>
      <h3>No teams yet!</h3>
      <p class="text-muted">Build your first competitive team and dominate the battlefield.</p>
      <%= link_to "Create Your First Team", new_team_path, class: "btn btn-primary" %>
    </div>
  <% end %>
  <hr style="margin: 2rem 0;">

  <div id="trainer-lookup" class="trainer-lookup">
    <h2>Find trainers to follow</h2>
    <p class="text-muted">
      Search by username or email to discover other members.
    </p>

    <%= form_with url: root_path, method: :get, local: true, class: "user-search-form" do |f| %>
      <div class="input-group" style="display: flex; gap: 0.75rem; margin-bottom: 1.5rem;">
        <%= f.label :user_query, "Search users", class: "sr-only" %>
        <%= f.text_field :user_query,
                         value: @user_query,
                         placeholder: "e.g. Misty, Brock, ash@poke.example",
                         class: "form-control",
                         style: "flex: 1;" %>
        <%= f.submit "Search", class: "btn btn-primary" %>
      </div>
    <% end %>

    <% if @user_results.present? %>
      <div class="card-list">
        <% @user_results.each do |user| %>
          <div class="card card-horizontal">
            <div>
              <strong><%= user.display_name %></strong><br>
              <span class="text-muted"><%= user.email %></span>
            </div>

            <div class="flex gap-2">
              <%= link_to "View Profile", user_path(user), class: "btn btn-secondary btn-small" %>

              <% if current_user.followees.exists?(user.id) %>
                <span class="badge badge-success">Following</span>
              <% else %>
                <%= button_to "Follow",
                              user_follow_path(user),
                              method: :post,
                              class: "btn btn-primary btn-small",
                              form: { data: { turbo: false } } %>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    <% elsif @user_query.present? %>
      <p class="text-muted">
        No trainers found matching "<%= h @user_query %>".
      </p>
    <% end %>
  </div>

<% else %>
  <div class="welcome-section">
    <h1>Welcome to PokÃ©Forum!</h1>
    <p class="text-muted" style="font-size: 1.2rem; max-width: 600px; margin: 0 auto;">
      The ultimate community for PokÃ©mon trainers. Build teams, discuss strategies, and connect with fellow trainers.
    </p>
    
    <div class="quick-links" style="margin-top: 2.5rem;">
      <%= link_to new_user_registration_path, class: "quick-link" do %>
        <div class="quick-link-icon">ğŸš€</div>
        <div>Get Started</div>
      <% end %>
      
      <%= link_to posts_path, class: "quick-link" do %>
        <div class="quick-link-icon">ğŸ’¬</div>
        <div>Browse Forum</div>
      <% end %>
      
      <%= link_to species_index_path, class: "quick-link" do %>
        <div class="quick-link-icon">ğŸ”</div>
        <div>Explore PokÃ©mon</div>
      <% end %>
    </div>
  </div>

  <hr>

  <div class="text-center" style="padding: 2rem 0;">
    <h2>Ready to join the community?</h2>
    <p class="text-muted">Create an account to build teams, follow your favorite PokÃ©mon, and join discussions.</p>
    <div class="flex flex-center gap-2" style="margin-top: 1.5rem;">
      <%= link_to "Create Account", new_user_registration_path, class: "btn btn-primary" %>
      <%= link_to "Sign In", new_user_session_path, class: "btn btn-secondary" %>
    </div>
  </div>
<% end %>
