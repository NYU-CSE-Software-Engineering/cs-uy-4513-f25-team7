<div class="forum-container">
  <% if notice %>
    <div class="alert alert-success"><%= notice %></div>
  <% end %>
  <% if alert %>
    <div class="alert alert-danger"><%= alert %></div>
  <% end %>
  <div class="post-detail">
    <div class="post-voting" data-controller="voting" data-voting-post-id-value="<%= @post.id %>">
      <%= form_with url: upvote_post_path(@post), method: :post, local: Rails.env.test?, class: 'vote-form' do |form| %>
        <%= form.submit '▲', class: 'vote-btn upvote-btn', data: { action: 'click->voting#upvote' } %>
      <% end %>
      
      <span class="vote-score" data-voting-target="score" data-post-id="<%= @post.id %>">
        <%= @post.vote_score rescue 0 %>
      </span>
      
      <%= form_with url: downvote_post_path(@post), method: :post, local: Rails.env.test?, class: 'vote-form' do |form| %>
        <%= form.submit '▼', class: 'vote-btn downvote-btn', data: { action: 'click->voting#downvote' } %>
      <% end %>
    </div>
    
    <div class="post-content">
      <h1 class="post-title"><%= @post.title %></h1>
      
      <div class="post-meta">
        <% if @post.tags.any? %>
          <div class="post-tags">
            <% @post.tags.each do |tag| %>
              <%= link_to tag.name, posts_path(tag: tag.name), class: 'tag' %>
            <% end %>
          </div>
        <% end %>
        <div class="post-info">
          <span class="post-date">Posted on <%= @post.created_at&.strftime('%B %d, %Y at %I:%M %p') || 'Date not available' %></span>
        </div>
      </div>
      
      <div class="post-body">
        <%= simple_format(@post.content) %>
      </div>
    </div>
  </div>
  
  <div class="post-actions">
    <%= link_to 'Edit', edit_post_path(@post), class: 'btn btn-secondary' %>
    <%= link_to 'Delete', post_path(@post), method: :delete, 
                confirm: 'Are you sure?', class: 'btn btn-danger' %>
    <%= link_to 'Back to Forum', posts_path, class: 'btn btn-outline' %>
  </div>
  
  <div class="comments-section">
    <h2>Comments</h2>
    
    <% if @post.comments.any? %>
      <div class="comments-list">
        <% @post.comments.each do |comment| %>
          <div class="comment">
            <div class="comment-body">
              <%= simple_format(comment.body) %>
            </div>
            <div class="comment-meta">
              <span class="comment-author">By <%= comment.user&.email || 'Unknown' %></span>
              <span class="comment-date"><%= comment.created_at&.strftime('%B %d, %Y at %I:%M %p') || 'Date not available' %></span>
              <% if current_user && comment.user && (current_user == comment.user || current_user.moderator? || current_user.admin?) %>
                <%= link_to 'Delete Comment', post_comment_path(@post, comment), method: :delete, 
                            confirm: 'Are you sure?', class: 'btn btn-danger btn-sm' %>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>
    
    <% if user_signed_in? %>
      <%= render 'comments/form', post: @post, comment: @comment %>
    <% else %>
      <p>Please sign in to comment.</p>
    <% end %>
  </div>
</div>
