<div data-test-id="post-show">
  <div class="card mb-4">
    <div class="card-body">
      <h1 class="card-title">
        <%= @post.title %>
        <% if @post.post_type == 'Meta' %>
          <span class="badge bg-info text-dark" data-test-id="post-badge-meta">Meta</span>
        <% else %>
          <span class="badge bg-secondary"><%= @post.post_type %></span>
        <% end %>
      </h1>
      <p class="text-muted">Posted by <%= @post.user.email %> on <%= @post.created_at.strftime("%B %d, %Y at %I:%M %p") %></p>
      <hr>
      <div class="card-text">
        <%= simple_format(@post.body) %>
      </div>
    </div>
  </div>

  <h1><%= @post.title %></h1>
  <p><%= @post.body %></p>

  <% if current_user && (current_user == @post.user || current_user.moderator? || current_user.admin?) %>
    <%= button_to "Delete Post",
                  post_path(@post),
                  method: :delete,
                  data: { confirm: "Are you sure you want to delete this post?" } %>
  <% end %>

  <h3>Comments</h3>
  <div id="comments">
    <% @comments.each do |comment| %>
      <div class="comment">
        <p><%= comment.body %></p>
        <p><em>by <%= comment.user.email %></em></p>

        <% if current_user && (current_user == comment.user || current_user.moderator? || current_user.admin?) %>
          <%= button_to "Delete Comment",
                        post_comment_path(@post, comment),
                        method: :delete,
                        data: { confirm: "Delete this comment?" } %>
        <% end %>
      </div>
    <% end %>
  </div>

  <% if user_signed_in? %>
    <div class="mt-4">
      <h4>Add a comment</h4>
      <%= render 'comments/form', post: @post, comment: @comment %>
    </div>
  <% else %>
    <p class="mt-4 text-muted">Please <%= link_to 'sign in', new_user_session_path %> to comment.</p>
  <% end %>

  <%= link_to 'Back to Forum', posts_path, class: 'btn btn-secondary mt-3' %>
</div>
