<div class="forum-container">
  <div class="forum-header">
    <h1>Forum</h1>
    <%= link_to 'New Post', new_post_path, class: 'btn btn-primary' %>
  </div>

<div class="search-filters">
  <%= form_with url: posts_path, method: :get, local: true, class: 'search-form' do |form| %>
    <div class="search-row">
      <%= form.text_field :search, placeholder: 'Search posts...', value: @search, class: 'search-input' %>
      <%= form.select :tag, options_from_collection_for_select(@all_tags, :name, :name, @tag_filter), 
                      { prompt: 'Filter by tag...' }, { class: 'tag-filter' } %>
      <%= form.submit 'Search', class: 'btn btn-secondary' %>
      <%= link_to 'Clear', posts_path, class: 'btn btn-outline' %>
    </div>
  <% end %>
</div>

<div class="posts-list">
  <% if @posts.any? %>
    <% @posts.each do |post| %>
      <div class="post-card">
        <div class="post-voting" data-controller="voting" data-voting-post-id-value="<%= post.id %>">
          <%= form_with url: upvote_post_path(post), method: :post, local: false, class: 'vote-form' do |form| %>
            <%= form.submit '▲', class: 'vote-btn upvote-btn', data: { action: 'click->voting#upvote' } %>
          <% end %>
          
          <span class="vote-score" data-voting-target="score" data-post-id="<%= post.id %>">
            <%= post.vote_score %>
          </span>
          
          <%= form_with url: downvote_post_path(post), method: :post, local: false, class: 'vote-form' do |form| %>
            <%= form.submit '▼', class: 'vote-btn downvote-btn', data: { action: 'click->voting#downvote' } %>
          <% end %>
        </div>
        
        <div class="post-content">
          <h3><%= link_to post.title, post_path(post), class: 'post-title' %></h3>
          <p class="post-preview"><%= truncate(post.content, length: 200) %></p>
          
          <div class="post-meta">
            <div class="post-tags">
              <% post.tags.each do |tag| %>
                <span class="tag"><%= tag.name %></span>
              <% end %>
            </div>
            <div class="post-info">
              <span class="post-date"><%= post.created_at.strftime('%B %d, %Y at %I:%M %p') %></span>
            </div>
          </div>
        </div>
      </div>
    <% end %>
    
    <div class="pagination">
      <%= paginate @posts %>
    </div>
  <% else %>
    <div class="no-posts">
      <p>No posts found. <%= link_to 'Create the first post!', new_post_path %></p>
    </div>
  <% end %>
</div>
</div>
