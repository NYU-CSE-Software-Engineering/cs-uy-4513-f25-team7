<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
  <div>
    <h1>ğŸ’¬ Forum</h1>
    <p class="text-muted">Join the conversation with fellow trainers</p>
  </div>
  <% if user_signed_in? %>
    <%= link_to 'New Post', new_post_path, class: 'btn btn-primary' %>
  <% end %>
</div>

<% if @posts.any? %>
  <!-- Category Navigation -->
  <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 2rem;">
    <% @post_types.each do |cat| %>
      <% count = @posts_by_type[cat[:type]]&.count || 0 %>
      <a href="#section-<%= cat[:type].downcase %>" 
         class="btn btn-secondary btn-small" 
         style="<%= count == 0 ? 'opacity: 0.5;' : '' %>">
        <%= cat[:icon] %> <%= cat[:type] %> (<%= count %>)
      </a>
    <% end %>
  </div>

  <!-- Posts by Category -->
  <% @post_types.each do |cat| %>
    <% posts_in_category = @posts_by_type[cat[:type]] || [] %>
    
    <div id="section-<%= cat[:type].downcase %>" class="forum-section" style="margin-bottom: 2.5rem;">
      <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem; padding-bottom: 0.75rem; border-bottom: 1px solid var(--border-color);">
        <span style="font-size: 1.5rem;"><%= cat[:icon] %></span>
        <div>
          <h2 style="margin: 0; font-size: 1.25rem;"><%= cat[:type] %></h2>
          <p class="text-muted text-small" style="margin: 0;"><%= cat[:description] %></p>
        </div>
        <span class="badge" style="margin-left: auto; background: var(--bg-input);"><%= posts_in_category.count %> posts</span>
      </div>

      <% if posts_in_category.any? %>
        <div class="posts-list">
          <% posts_in_category.each do |post| %>
            <div class="post-card">
              <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                <div style="flex: 1;">
                  <h4 style="margin-bottom: 0.5rem;">
                    <%= link_to post.title, post %>
                  </h4>
                  <p class="text-muted text-small" style="margin-bottom: 0.75rem;">
                    Posted by <strong><%= post.user.display_name %></strong>
                    Â· <%= time_ago_in_words(post.created_at) %> ago
                    Â· <%= post.comments.count %> <%= "comment".pluralize(post.comments.count) %>
                    <% if post.dex_species %>
                      Â· in <%= link_to post.dex_species.name, species_path(name: post.dex_species.name) %>
                    <% end %>
                  </p>
                  <p class="text-secondary" style="margin: 0;"><%= truncate(post.body, length: 150) %></p>
                </div>
                <%= link_to "View â†’", post, class: "btn btn-secondary btn-small", style: "margin-left: 1rem;" %>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="card" style="padding: 1.5rem; text-align: center; opacity: 0.7;">
          <p class="text-muted" style="margin: 0;">No <%= cat[:type].downcase %> posts yet. Be the first to start one!</p>
        </div>
      <% end %>
    </div>
  <% end %>

<% else %>
  <div class="card text-center" style="padding: 3rem;">
    <p style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“</p>
    <h3>No posts yet</h3>
    <p class="text-muted">Be the first to start a discussion!</p>
    <% if user_signed_in? %>
      <%= link_to "Create First Post", new_post_path, class: "btn btn-primary" %>
    <% else %>
      <%= link_to "Sign in to Post", new_user_session_path, class: "btn btn-primary" %>
    <% end %>
  </div>
<% end %>
